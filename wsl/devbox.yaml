# From https://github.com/microsoft/devcenter-examples
$schema: 1.0
tasks:
  - name: choco
    parameters:
      package: vscode
  - name: powershell
    parameters:
      command: |
        # download the linux distribution
        $distroFolder = 'C:\Distro'
        $distroFile = $distroFolder+'\Ubuntu-Splunk.tar'
        New-Item $distroFolder -ItemType Directory -Force
        # $downloadUrl = 'https://stdevboxtools.blob.core.windows.net/distro/Ubuntu-22.04.tar?sp=r&st=2024-04-24T13:06:14Z&se=2024-06-29T21:06:14Z&spr=https&sv=2022-11-02&sr=b&sig=SnaZ2D50vZsK%2BCorxFpGBLndCqbeI7o27IVXmQMR6C8%3D'
        # (New-Object System.Net.WebClient).DownloadFile($downloadUrl, $distroFile) 
#userTasks:
  - name: powershell-runas
    description: Admin cannot access wsl, so put the task to user level
    parameters:
      runAsUser: true
      command: |
        # install vscode wsl extension
        code --install-extension ms-vscode-remote.remote-wsl

        # set firewall
        New-Item -path $env:userprofile -name '.wslconfig' -type 'file' -value \"[wsl2]`r`n\" -Force
        Add-Content -Path $env:userprofile'\.wslconfig' -Value \"firewall=true`r`n\"

        # import wsl distro
        $distroName = 'Ubuntu-22.04'
        $installLocation = 'C:\linux'
        $distroFile = 'C:\Distro\Ubuntu-Splunk.tar'
        New-Item $installLocation -ItemType Directory -Force
        wsl --import $distroName $installLocation $distroFile 
        wsl -s $distroName
